{
  # Email para Let's Encrypt (requerido para certificados SSL)
  email miltonbeltrac18@gmail.com
  # Modo desarrollo: logs más verbosos si quieres
  # debug
}

# Escuchar en puerto 8443 para HTTPS alternativo
:8443 {
  encode gzip
  tls /etc/caddy/certs/localhost+2.pem /etc/caddy/certs/localhost+2-key.pem

  # Rutas hacia el backend (API)
  handle_path /api/* {
    uri strip_prefix /api
    reverse_proxy api:8000
  }

  # Accesos directos a /docs y /openapi.json
  @docs path /docs* /openapi.json
  handle @docs {
    reverse_proxy api:8000
  }

  # Resto del tráfico → frontend Next.js
  handle {
    reverse_proxy frontend:3000
  }
}

# Configuración con tu dominio real
# Asegúrate de que miltonbeltran.online apunte a tu IP pública
miltonbeltran.online {
  encode gzip
  
  # Let's Encrypt gestionará automáticamente los certificados SSL
  # Caddy obtendrá y renovará los certificados automáticamente

  # Rutas hacia el backend (API)
  handle_path /api/* {
    uri strip_prefix /api
    reverse_proxy api:8000
  }

  # Accesos directos a /docs y /openapi.json
  @docs path /docs* /openapi.json
  handle @docs {
    reverse_proxy api:8000
  }

  # Resto del tráfico → frontend Next.js
  handle {
    reverse_proxy frontend:3000
  }
}

# También mantener localhost para desarrollo local
localhost {
  encode gzip
  tls /etc/caddy/certs/localhost+2.pem /etc/caddy/certs/localhost+2-key.pem  # Certificados mkcert (confiables)

  # Rutas hacia el backend (API)
  handle_path /api/* {
    uri strip_prefix /api
    reverse_proxy api:8000
  }

  # Accesos directos a /docs y /openapi.json
  @docs path /docs* /openapi.json
  handle @docs {
    reverse_proxy api:8000
  }

  # Resto del tráfico → frontend Next.js
  handle {
    reverse_proxy frontend:3000
  }
}
